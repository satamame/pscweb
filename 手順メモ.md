# 手順メモ

## プロジェクト用リポジトリの中に仮想環境を作る
```
> python -m venv pscwebenv
```
- pscweb/
    - pscwebenv/

## 仮想環境に入る
```
> pscwebenv\Scripts\activate.bat
```

## 仮想環境に Django をインストール
```
(pscwebenv) > pip install django
```

## プロジェクトを作成
```
(pscwebenv) > django-admin startproject pscweb_prj
```
- pscweb/
    - pscweb_prj/
        - pscweb_prj/
    - pscwebenv/

## プロジェクトの日本語化
pscweb_prj\pscweb_prj\settings.py
```python
LANGUAGE_CODE = 'ja-JP'
TIME_ZONE = 'Asia/Tokyo'
```

## データベースの設定
### 1. PyMySQL, mysqlclient をインストールする。
```
(pscwebenv) > pip install PyMySQL
...
(pscwebenv) > pip install mysqlclient
...
```

### 2. settings.py の編集
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'djpscweb',
        'USER': 'django_pscweb',
        'PASSWORD': 'shimobe&563',
        'HOST': '127.0.0.1',
        'PORT': '3306',
    }
}
```

### 3. データベースの作成
- MySQL CLI でデータベースとユーザを作成し、ユーザにはデータベース作成権限を与える。
- MySQL CLI を起動するとパスワードを聞かれるので、root のパスワード（kimpatsu%563）を入力する。
```
mysql> CREATE DATABASE djpscweb;
Query OK, 1 row affected (0.10 sec)

mysql> CREATE USER django_pscweb@localhost IDENTIFIED BY 'shimobe&563';
Query OK, 0 rows affected (0.11 sec)

mysql> GRANT ALL ON djpscweb.* TO django_pscweb@localhost;
Query OK, 0 rows affected (0.01 sec)

mysql> GRANT CREATE ON *.* TO django_pscweb@localhost;
Query OK, 0 rows affected (0.03 sec)
```

### 4. パスワードの認証方法を変更
- MySQL 8.0 以降でデフォルトの認証プラグインが変更になり、Django からアクセスできなくなった。  
解決するには、ユーザを作ったら MySQL CLI から以下を実行。
    ```
    mysql> alter user 'django_pscweb'@'localhost' identified WITH mysql_native_password by 'shimobe&563';
    ```

### 5. テーブルの作成
1. プロジェクトのルートディレクトリに入っておく。
    ```
    (pscwebenv) > cd pscweb_prj
    ```

- モデル構造に基づいてテーブルを作るには、migrate コマンドを使う。
    ```
    (pscwebenv) > python manage.py migrate
    ```
- モデル構造に変更があった場合は、makemigrations してから migrate する。
    ```
    (pscwebenv) > python manage.py makemigrations <アプリ名>
    (pscwebenv) > python manage.py migrate
    ```

## スーパーユーザの作成
```
(pscwebenv) > python manage.py createsuperuser
Username (leave blank to use 'sata'): satamame
Email address: satax@nifty.com
Password: xxxxxx7x
Password (again): xxxxxx7x
Superuser created successfully.
```

## ここまでで出来るようになったこと
- runserver して、ログイン画面を表示
- スーパーユーザでログイン
- スーパーユーザで、ユーザとグループを編集
- ログアウト
