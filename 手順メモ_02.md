# 手順メモ_02

## アプリケーションの追加
- 以下のアプリケーションを追加する。
    - accounts (認証, プロファイル管理)
    - schedules (スケジュール管理)
- プロジェクトルートで以下を実行。
    ```
    (pscwebenv) >  python manage.py startapp accounts
    (pscwebenv) >  python manage.py startapp schedules
    ```
- プロジェクトの settings.py の INSTALLED_APPS を追加。
    ```
    INSTALLED_APPS = [
        ...,
        'accounts.apps.AccountsConfig',     # これを追記
        'schedules.apps.SchedulesConfig',   # これを追記
    ]
    ```

## ログイン・ログアウト・サインアップ
### 参考
- [Django2 でユーザー認証（ログイン認証）を実装するチュートリアル -2- ](https://it-engineer-lab.com/archives/544)

### 手順
- プロジェクトの urls.py の urlpatterns を追加。
    - ログイン画面の URL は、/accounts/login/
    ```
    from django.urls import path, include

    urlpatterns = [
        ...,
        path('accounts/', include('django.contrib.auth.urls')),    # これを追記
    ]
    ```
    - この include が何を読み込むかは、[Djangoの認証システムを使用する/Web のリクエストにおける認証/Authentication Views](https://docs.djangoproject.com/ja/2.0/topics/auth/default/#module-django.contrib.auth.views) を参照。
    - 出来合いの view を使いたい場合は、django.contrib.auth.views.LoginView/LogoutView などが使えるが、その場合は urlpatterns をそれに合わせないといけない。
        - accounts 側で URL の設定をすると、name='login' が {% url 'accounts:login' %} でないと参照できなくなるので、それはそれで面倒。
- 必要なら、プロジェクトの settings.py の LOGIN_REDIRECT_URL (ログイン後のリダイレクト先) を設定。
    ```
    LOGIN_REDIRECT_URL = '/'
    ```
    ※デフォルトでは /accounts/profile/ にリダイレクトされるらしい。  
    ※今回はデフォルトで。

- ビューのベーステンプレートを作る。
    - プロジェクト直下に templates ディレクトリを作る（他の場所でも良いが、その場合は下の TEMPLATES の設定を変えること）。
    - その中に base.html を作る。
        - デザインを変えたければ、後でこのファイルだけ編集すれば良い。
    - プロジェクトの settings.py の TEMPLATES に情報を追加。
        - 下はプロジェクト直下に templates を作った場合。
        ```
        TEMPLATES = [
            {
                ...,
                'DIRS': [os.path.join(BASE_DIR, 'templates')],  # <- こうする。
                ...,
            }
        ]
        ```
- ログイン/ログアウト画面のビューのテンプレートを作る。
    - ログイン画面: templates/registration/login.html
    - ログアウト画面: templates/registration/logged_out.html
    - /admin/login/ のビューをそのまま使わせて欲しいが、自分で作らないと駄目らしい。
    - これも後で変えれば良いので今はコピペで済ませる。
    - 複雑さが手に負えるうちに、動くようにする。

**次回、「サインアップの実装」から**

qwerty
qwerty0987